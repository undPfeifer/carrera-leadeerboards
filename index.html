<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Carrera Leaderboard</title>
    <style>
      body {
        font-family: "Courier New", Courier, monospace;
        background-color: white;
        color: red;
        padding: 20px;
        line-height: 1.2;
        font-size: 16px;
      }
      h1,
      h2 {
        margin: 0;
        padding: 0;
        font-size: 16px;
        font-weight: normal;
      }
      #fastestLapList {
        list-style-type: none;
        padding: 0;
        margin: 20px 0;
      }
      #fastestLapList li {
        margin-bottom: 5px;
      }
      .position {
        display: inline-block;
        width: 20px;
      }
      input {
        font-family: "Courier New", Courier, monospace;
        background-color: white;
        color: red;
        border: 1px solid red;
        padding: 5px;
        margin-right: 10px;
        width: 100px;
      }
      button {
        font-family: "Courier New", Courier, monospace;
        background-color: white;
        color: red;
        border: 1px solid red;
        padding: 5px 10px;
        cursor: pointer;
      }
      #errorMessage {
        margin-top: 10px;
      }
      .confirm-dialog {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: white;
        border: 1px solid red;
        padding: 20px;
        display: none;
      }
      .overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(255, 255, 255, 0.8);
        display: none;
      }
    </style>
  </head>
  <body>
    <h1>FASTEST LAP</h1>
    <h2>OVERALL</h2>

    <ol id="fastestLapList"></ol>

    <div>
      <input type="text" id="lapTimeInput" placeholder="LAP TIME" />
      <input type="text" id="racerNameInput" placeholder="RACER NAME" />
      <input type="text" id="carNameInput" placeholder="CAR NAME" />
      <button onclick="addLapTime()">ADD LAP</button>
    </div>
    <div id="errorMessage"></div>

    <div class="overlay" id="overlay"></div>
    <div class="confirm-dialog" id="confirmDialog">
      <p>DELETE THIS ENTRY?</p>
      <button onclick="confirmDelete()">YES</button>
      <button onclick="cancelDelete()">NO</button>
    </div>

    <script>
      let itemToDelete = null;

      function addLapTime() {
        const timeInput = document.getElementById("lapTimeInput");
        const nameInput = document.getElementById("racerNameInput");
        const carInput = document.getElementById("carNameInput");
        const errorMessage = document.getElementById("errorMessage");
        const lapTime = timeInput.value.trim();
        const racerName = nameInput.value.trim().toUpperCase();
        const carName = carInput.value.trim().toUpperCase();

        const timeFormat = /^([0-5]?[0-9]):([0-9][0-9])$/;

        if (timeFormat.test(lapTime) && racerName && carName) {
          errorMessage.textContent = "";
          addItemToList(lapTime, racerName, carName);
          timeInput.value = "";
          nameInput.value = "";
          carInput.value = "";
          sortList();
        } else {
          errorMessage.textContent =
            "INVALID INPUT. USE FORMAT: MM:SS, NAME, CAR";
        }
      }

      function addItemToList(lapTime, racerName, carName) {
        const list = document.getElementById("fastestLapList");
        const newItem = document.createElement("li");
        newItem.innerHTML = `
          <span class="position"></span>
          <span class="time">${lapTime}</span> ${racerName} ${carName}
          <button onclick="showDeleteConfirmation(this)">X</button>
        `;
        list.appendChild(newItem);
      }

      function showDeleteConfirmation(button) {
        itemToDelete = button.parentNode;
        document.getElementById("overlay").style.display = "block";
        document.getElementById("confirmDialog").style.display = "block";
      }

      function confirmDelete() {
        if (itemToDelete) {
          itemToDelete.parentNode.removeChild(itemToDelete);
          itemToDelete = null;
        }
        hideDeleteConfirmation();
        updatePositions();
      }

      function cancelDelete() {
        itemToDelete = null;
        hideDeleteConfirmation();
      }

      function hideDeleteConfirmation() {
        document.getElementById("overlay").style.display = "none";
        document.getElementById("confirmDialog").style.display = "none";
      }

      function sortList() {
        const list = document.getElementById("fastestLapList");
        const items = Array.from(list.getElementsByTagName("li"));

        items.sort((a, b) => {
          const timeA = a.querySelector(".time").textContent;
          const timeB = b.querySelector(".time").textContent;
          return convertToSeconds(timeA) - convertToSeconds(timeB);
        });

        while (list.firstChild) {
          list.removeChild(list.firstChild);
        }

        items.forEach((item) => list.appendChild(item));
        updatePositions();
      }

      function updatePositions() {
        const items = document.querySelectorAll("#fastestLapList li");
        items.forEach((item, index) => {
          item.querySelector(".position").textContent = index + 1 + " ";
        });
      }

      function convertToSeconds(timeString) {
        const [minutes, seconds] = timeString.split(":").map(Number);
        return minutes * 60 + seconds;
      }

      // Add initial items
      addItemToList("29:88", "DIMI", "GREEN CAR");
      addItemToList("30:08", "DIMI", "GREEN CAR");
      addItemToList("31:10", "DIMI", "WHITE PORSCHE");
      sortList();
    </script>
  </body>
</html>
